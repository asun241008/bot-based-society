//@version=5
indicator("Auto MA by Timeframe", overlay=true)

// 시간프레임별 이동평균선 수치 자동 설정
get_ma_period(tf_minutes) =>
    switch tf_minutes
        1   => [8, 18, 100, 200]      // 1분봉
        3   => [8, 18, 100, 200]    // 3분봉  
        5   => [8, 18, 100, 200]    // 5분봉
        15  => [8, 18, 768, 1728]   // 15분봉
        30  => [8, 18, 384, 864]   // 30분봉
        60  => [8, 18, 192, 432]   // 1시간봉
        120 => [8, 18, 96, 216]
        240 => [8, 18, 48, 108]     // 4시간봉
        => [8, 18, 365, 730]        // 일봉 이상 (기본값)

// 현재 시간프레임을 분 단위로 변환
current_tf_minutes = timeframe.in_seconds() / 60

// 해당 시간프레임의 이동평균선 수치 가져오기
[ma1_period, ma2_period, ma3_period, ma4_period] = get_ma_period(current_tf_minutes)

// 이동평균선 계산
ma1 = ta.sma(close, ma1_period)
ma2 = ta.sma(close, ma2_period)  
ma3 = ta.sma(close, ma3_period)
ma4 = ta.sma(close, ma4_period)

// 차트에 그리기
plot(ma1, "단기선1", color=color.yellow, linewidth=1)
plot(ma2, "단기선2", color=color.blue, linewidth=1)
plot(ma3, "장기선1", color=color.yellow, linewidth=2)
plot(ma4, "장기선2", color=color.blue, linewidth=2)

// 테이블 위치 설정 (사용자가 선택 가능)
table_position = input.string("bottom_left", "테이블 위치", options=["top_left", "top_right", "bottom_left", "bottom_right", "middle_left", "middle_right", "hide"])

// 현재 설정 표시 (위치 선택 가능)
get_table_position(pos_string) =>
    switch pos_string
        "top_left" => position.top_left
        "top_right" => position.top_right
        "bottom_left" => position.bottom_left
        "bottom_right" => position.bottom_right
        "middle_left" => position.middle_left
        "middle_right" => position.middle_right
        => position.bottom_left

// 테이블 생성 및 표시
if table_position != "hide"
    var table info_table = table.new(get_table_position(table_position), 2, 5, bgcolor=color.new(color.black, 80), border_width=1, frame_width=1, frame_color=color.gray)
    
    if barstate.islast
        table.cell(info_table, 0, 0, "Timeframe", text_color=color.white, bgcolor=color.new(color.gray, 50))
        table.cell(info_table, 1, 0, timeframe.period, text_color=color.white, bgcolor=color.new(color.gray, 50))
        table.cell(info_table, 0, 1, "단기선1", text_color=color.yellow, bgcolor=color.new(color.black, 70))
        table.cell(info_table, 1, 1, str.tostring(ma1_period), text_color=color.yellow, bgcolor=color.new(color.black, 70))
        table.cell(info_table, 0, 2, "단기선2", text_color=color.blue, bgcolor=color.new(color.black, 70))
        table.cell(info_table, 1, 2, str.tostring(ma2_period), text_color=color.blue, bgcolor=color.new(color.black, 70))
        table.cell(info_table, 0, 3, "장기선1", text_color=color.yellow, bgcolor=color.new(color.black, 70))
        table.cell(info_table, 1, 3, str.tostring(ma3_period), text_color=color.yellow, bgcolor=color.new(color.black, 70))
        table.cell(info_table, 0, 4, "장기선2", text_color=color.blue, bgcolor=color.new(color.black, 70))
        table.cell(info_table, 1, 4, str.tostring(ma4_period), text_color=color.blue, bgcolor=color.new(color.black, 70))
